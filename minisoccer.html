<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reservasi Mini Soccer</title>
  <link rel="stylesheet" href="stylemiso.css">
</head>
<body>
  <header>
    <a class="back-btn" href="index.html">â¬… Kembali</a>
    <span>Reservasi Mini Soccer</span>
  </header>

  <main>
    <div class="search-box">
      <input id="searchInput" type="text" placeholder="Cari nama..." oninput="filterTable()" />
    </div>

    <table id="reservasiTable">
      <thead>
        <tr><th>Jam</th><th>Nama</th></tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="2" class="muted">Memuat data...</td></tr>
      </tbody>
    </table>
  </main>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbzbbfsQfOkODPZ0UC7_ry1hnVkDtmFOcU3otcXtzW4UssEcQOxle9RuXkmqHfC37T_l/exec";

    // Buat jam otomatis dari 08:00-09:00 hingga 23:00-24:00
    const jamSlots = [];
    for (let h = 8; h <= 23; h++) {
      const jamMulai = h.toString().padStart(2,'0') + ":00";
      const jamSelesai = (h+1).toString().padStart(2,'0') + ":00";
      jamSlots.push(`${jamMulai} - ${jamSelesai}`);
    }

    async function loadData() {
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";

      // Buat baris awal dengan jam otomatis
      jamSlots.forEach(jam => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${jam}</td><td></td>`;
        tbody.appendChild(tr);
      });

      try {
        const resp = await fetch(`${scriptURL}?sheet=reservasi`);
        if (!resp.ok) throw new Error('HTTP ' + resp.status + ' ' + resp.statusText);

        const data = await resp.json();
        console.log("Data dari WebApp:", data);

        // Jika data array of array atau object
        data.forEach(item => {
          let nama = '';
          let jam = '';
          if (Array.isArray(item)) {
            jam = item[0];
            nama = item[1] || '';
          } else if (typeof item === 'object') {
            const keys = Object.keys(item);
            jam = item[keys.find(k => /Jam|waktu|time/i.test(k))] || '';
            nama = item[keys.find(k => /Nama|name/i.test(k))] || '';
          }

          // Cari baris sesuai jam, isi nama
          const rows = tbody.querySelectorAll("tr");
          rows.forEach(r => {
            if (r.cells[0].textContent.trim() === jam) {
              r.cells[1].textContent = nama;
              if (nama.trim() !== '') r.cells[1].classList.add('filled');
            }
          });
        });

      } catch (err) {
        tbody.innerHTML = `<tr><td colspan="2" class="muted">Gagal memuat data: ${err.message}</td></tr>`;
      }
    }

    function filterTable() {
      const q = document.getElementById('searchInput').value.trim().toLowerCase();
      const rows = document.querySelectorAll('#reservasiTable tbody tr');
      rows.forEach(r => {
        const nameCell = r.cells[1];
        if (!nameCell) return;
        const txt = nameCell.textContent.toLowerCase();
        r.style.display = q === '' || txt.includes(q) ? '' : 'none';
      });
    }

    window.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>
</html>
